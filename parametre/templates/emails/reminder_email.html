<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="fr">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>KORA - Rappel d'échéances</title>
    <style type="text/css">
        {% include 'emails/email_styles.css' %}
    </style>
    <!--[if mso]>
    <style type="text/css">
        body, table, td {font-family: Arial, sans-serif !important;}
    </style>
    <![endif]-->
</head>
<body>
    <table border="0" cellpadding="0" cellspacing="0" width="100%" class="email-wrapper">
        <tr>
            <td align="center">
                <!-- Container principal -->
                <table border="0" cellpadding="0" cellspacing="0" width="600" class="email-container">
                    
                    <!-- Header avec logo et titre -->
                    <tr>
                        <td class="email-header-primary">
                            <table border="0" cellpadding="0" cellspacing="0" width="100%">
                                <tr>
                                    <td align="center">
                                        <h1 class="email-logo">KORA</h1>
                                        <p class="email-subtitle email-subtitle-primary">Autorité Nationale de l'Aviation Civile</p>
                                        <div class="email-divider"></div>
                                        <p class="email-title">Rappel d'échéances</p>
                                    </td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                    
                    <!-- Contenu principal -->
                    <tr>
                        <td class="email-content">
                            <table border="0" cellpadding="0" cellspacing="0" width="100%">
                                <tr>
                                    <td>
                                        <p class="email-greeting">
                                            Madame, Monsieur <strong class="color-primary">{{ user_name }}</strong>,
                                        </p>
                                        
                                        <p class="email-text">
                                            Vous avez <strong>{{ notifications|length }}</strong> échéance(s) approchant dans le système KORA. Veuillez prendre les mesures nécessaires pour respecter les délais.
                                        </p>
                                    </td>
                                </tr>
                            </table>
                            
                            <!-- Liste des notifications -->
                            {% for notification in notifications %}
                            <table border="0" cellpadding="0" cellspacing="0" width="100%" class="notification-card">
                                <tr>
                                    <td style="padding: 0;">
                                        <!-- Barre de couleur latérale -->
                                        <table border="0" cellpadding="0" cellspacing="0" width="100%">
                                            <tr>
                                                <td width="6" class="notification-priority-bar priority-{{ notification.priority|default:'medium' }}"></td>
                                                <td class="notification-card-content">
                                                    <table border="0" cellpadding="0" cellspacing="0" width="100%">
                                                        <tr>
                                                            <td>
                                                                <h3 class="notification-title">
                                                                    PAC {{ notification.numero_pac }}
                                                                </h3>
                                                                
                                                                <table border="0" cellpadding="0" cellspacing="0" width="100%" class="notification-details-table">
                                                                    <tr>
                                                                        <td class="notification-label">
                                                                            <strong>Processus:</strong>
                                                                        </td>
                                                                        <td class="notification-value">
                                                                            {{ notification.processus_name }}
                                                                        </td>
                                                                    </tr>
                                                                    <tr>
                                                                        <td class="notification-label">
                                                                            <strong>Action:</strong>
                                                                        </td>
                                                                        <td class="notification-value notification-value-secondary">
                                                                            {{ notification.action }}
                                                                        </td>
                                                                    </tr>
                                                                    {% if notification.nature_label %}
                                                                    <tr>
                                                                        <td class="notification-label">
                                                                            <strong>Nature:</strong>
                                                                        </td>
                                                                        <td class="notification-value notification-value-secondary">
                                                                            {{ notification.nature_label }}
                                                                        </td>
                                                                    </tr>
                                                                    {% endif %}
                                                                    <tr>
                                                                        <td class="notification-label">
                                                                            <strong>Échéance:</strong>
                                                                        </td>
                                                                        <td class="notification-value notification-value-urgent">
                                                                            {{ notification.due_date_formatted }}
                                                                        </td>
                                                                    </tr>
                                                                    <tr>
                                                                        <td class="notification-label">
                                                                            <strong>Jours restants:</strong>
                                                                        </td>
                                                                        <td class="notification-value notification-value-urgent">
                                                                            {{ notification.days_remaining }} jour{{ notification.days_remaining|pluralize }}
                                                                        </td>
                                                                    </tr>
                                                                </table>
                                                            </td>
                                                        </tr>
                                                    </table>
                                                </td>
                                            </tr>
                                        </table>
                                    </td>
                                </tr>
                            </table>
                            {% endfor %}
                            
                            <!-- Appel à l'action -->
                            <table border="0" cellpadding="0" cellspacing="0" width="100%" style="margin-top: 30px;">
                                <tr>
                                    <td class="alert-box alert-info">
                                        <p style="margin: 0;">
                                            <strong>Important :</strong> Connectez-vous au système KORA pour traiter ces échéances dans les meilleurs délais.
                                        </p>
                                    </td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                    
                    <!-- Footer -->
                    <tr>
                        <td class="email-footer">
                            <table border="0" cellpadding="0" cellspacing="0" width="100%">
                                <tr>
                                    <td align="center">
                                        <p class="footer-text">
                                            <strong>Autorité Nationale de l'Aviation Civile (ANAC)</strong>
                                        </p>
                                        <p class="footer-text-small">
                                            Message automatique envoyé par KORA le {{ current_date }}
                                        </p>
                                        <p class="footer-text-small-last">
                                            Merci de ne pas répondre à cet email
                                        </p>
                                    </td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                    
                </table>
                <!-- Fin du container principal -->
            </td>
        </tr>
    </table>
</body>
</html>
